import csv
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import requests
from bs4 import BeautifulSoup

BASE_URL = "https://www.justwatch.com/us/search?q="

def fetch_movie_data(movie_name):
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36"
    }
    
    response = requests.get(BASE_URL + movie_name, headers=headers)
    if response.status_code != 200:
        print(f"Failed to retrieve the webpage for {movie_name} from JustWatch.")
        return None, None
    
    soup = BeautifulSoup(response.content, 'html.parser')
    disney_link = soup.find('div', class_='buybox-row__offers').find('a')['href']

    driver = webdriver.Chrome()  # Ensure chromedriver is in PATH or specify executable_path
    driver.get(disney_link)

    try:
        element = WebDriverWait(driver, 60).until(
            EC.presence_of_element_located((By.CSS_SELECTOR, ".sc-ccbnFN.jZELRG img"))
        )
        rating_img_element = driver.find_element(By.CSS_SELECTOR, ".sc-ccbnFN.jZELRG img")
        rating_img_link = rating_img_element.get_attribute("src")
    except:
        print(f"Failed to load the desired content for {movie_name} from Disney+.")
        driver.quit()
        return None, None

    driver.quit()
    return movie_name, rating_img_link


# movie_names =[ "The Tortoise and the Hare", "Lonesome Ghosts", "Treasure Island", "Early to Bed", "Saludos Amigos", "Melody Time", "Three Little Pigs", "The Big Bad Wolf", "Mickey's Trailer", "Santa's Workshop", "Flowers and Trees","The Ugly Duckling",'The Grasshopper and the Ants', 'The Old Mill', 'The Band Concert', 'Beach Picnic', 'Brave Little Tailor', 'Mr. Mouse Takes a Trip', "Mickey's Birthday Party", 'How to Fish', 'Chef Donald', 'The Wise Little Hen', 'Clock Cleaners', 'Three Blind Mouseketeers', 'On Ice', "Chip an' Dale", 'The Little Whirlwind', 'Thru The Mirror', 'Ye Olden Days', 'The Golden Touch', "Mickey's Rival", 'Three Little Wolves', 'How to Swim', "Donald's Golf Game", "Pluto's Sweater", 'Mr. Duck Steps Out', "Donald's Tire Trouble", 'All in a Nutshell', 'Toby Tortoise Returns', 'Society Dog Show', 'Mickey and the Seal', "Food for Feudin'", 'The Olympic Champ', 'Boat Builders', 'Tugboat Mickey', "Donald's Dog Laundry", 'A Knight for a Day', 'The Art of Skiing', 'Winter Storage', 'The Pied Piper', 'Swiss Family Robinson', 'The Goddess of Spring', 'Canine Caddy', "Mickey's Delayed Date", 'Bone Bandit', 'Babes in the Woods', 'Mickey Down Under', 'Rescue Dog', 'How to Play Football', 'Pluto and the Gopher', 'Mail Dog', 'The Hockey Champ', 'Double Dribble', "Pluto's Surprise Package", 'How to Play Baseball', 'Sea Scouts', "Pluto's Purchase", 'Beaver Valley', 'Schoolhouse Rock!', 'Emil and the Detectives', 'The Prince and the Pauper', 'Man in Space', 'The Story of the Faithful Wookiee', 'Mars and Beyond', 'Old Yeller', 'Lambert the Sheepish Lion', 'Pollyanna', 'The Shaggy Dog', 'The Story of Robin Hood and His Merrie Men', 'The Sign of Zorro', 'Trick or Treat', "Let's Stick Together", 'Beezy Bear', 'Third Man on the Mountain', 'The New Neighbor', 'Dragon Around', "Pluto's Party", "Don's Fountain of Youth", 'Grand Canyonscope', 'Almost Angels', 'Bearly Asleep', 'Corn Chips', 'Spin and Marty', 'The Simple Things', 'Out of Scale', 'The Boy Who Talked to Badgers', 'My Dog the Thief', 'Water Birds', "Nature's Half Acre", 'The Ghosts of Buxley Hall', 'The Olympic Elk', 'Prowlers of the Everglades', 'The Mouseketeers at Walt Disney World', 'Sultan and the Rock Star', 'The Pre-Opening Report from Disneyland', 'The Plausible Impossible', 'Mr. Boogedy', 'The Christmas Star', 'Ready to Run', 'Quack Pack', "Mom's Got a Date with a Vampire", 'You Lucky Dog', 'Miracle at Midnight', 'Mark Twain and Me', 'Ancient X-Files', "Riding Britain's Railways", 'Spider-Man: The New Animated Series', 'Empire of Dreams: The Story of the Star Wars Trilogy', 'The Birth of Big Air', "World's Deadliest", 'Kings Ransom', 'Four Days in October', 'Guru of Go', 'George of the Jungle 2', 'Jump In!', 'Jack-Jack Attack', 'Monster Truck Mater', 'Tokyo Mater', 'Den Brother', 'Unidentified Flying Mater', 'Johnny Kapahala: Back on Board', 'Rescue Squad Mater', 'Heavy Metal Mater', 'Full-Court Miracle', 'Pixel Perfect', 'Buffalo Dreams', 'Zenon: Z3', 'The Scream Team', 'A Ring of Endless Light', 'You Wish!', 'Hounded', 'The Best That Never Was', 'Pony Excess', 'Going to the Mat', 'Small Potatoes: Who Killed the USFL?', 'Journey to Shark Eden', 'The Lion Ranger', 'Jordan Rides the Bus', "The Band That Wouldn't Die", 'Fernando Nation', 'Silly Little Game', 'Run Ricky Run', 'Clan of the Meerkat', 'The Little Mermaid Sing-Along', 'Night Stalkers', 'The Witch Doctor Will See You Now', 'Paperman', "Good Luck Charlie, It's Christmas!", 'Celebrity House Hunting', 'Birth of Europe', 'Partysaurus Rex', 'The Christmas Consultant', "There's No Place Like Home", 'Winged Seduction: Birds of Paradise', 'Cesar Millan: The Real Story', "America's Greatest Animals", "Mickey's Mousekersize", 'Special Agent Oso: Three Healthy Steps', 'Ultimate Airport Dubai', 'Blow Your Mind', 'Bloody Tales of Europe', 'Science of Stupid', 'American Blackout', "Area 51: The CIA's Secret", 'Big Shot', 'Brian and the Boz', 'The Book of Manning', 'Bad Boys', 'Car S.O.S.', 'The Day The Series Stopped', 'Youngstown Boys', 'Wild Hawaii', 'Survive and Advance', 'Zapped', 'The Santa Con', 'The Radiator Springs 500¬Ω', 'Hiccups', 'Miracle Landing on the Hudson', 'Spinning', 'LEGO Star Wars: The New Yoda Chronicles - Clash of the Skywalkers', 'Bugged', 'LEGO Star Wars: The New Yoda Chronicles - Raid on Coruscant', 'Drain the Bermuda Triangle', 'LEGO Star Wars: The New Yoda Chronicles - Race For The Holocrons', 'Hawaiian: The Legend of Eddie Aikau', 'Slaying the Badger', 'Wild Congo', 'Beyond Magic with DMC', 'Brothers in Exile', 'Elway To Marino', 'LEGO Start Wars: The New Yoda Chronicles: Duel of the Skywalkers', "Jim Henson's Turkey Hollow", 'The Challenger Disaster: Lost Tapes', 'Fantastic Lies', 'Supercar Megabuild', 'T. Rex Autopsy', 'Four Falls of Buffalo', 'Strangest Bird Alive', 'The Gospel According to Mac', 'The Greeks', 'Catholics vs. Convicts', "Disney's Broadway Hits at London's Royal Albert Hall", 'I Hate Christian Laettner', 'Alvin and the Chipmunks: The Road Chip', 'Soy Luna', 'Bad Hair Day', 'Believeland', 'Alex & Co.', 'House of Darkness', 'Expedition Mars', 'This Magic Moment', 'Mission Pluto', 'Trojan War', 'Drain the Titanic', 'Mega Hammerhead', 'How Dogs Got Their Shapes', 'Phi Slama Jama', "Hubble's Cosmic Journey", 'Doc & Darryl', 'Bride & Prejudice', 'First Class Chefs', 'United Sharks of America', 'The Kangaroo King', "World's Greatest Dogs", 'Nature Boom Time', 'Big Cat Games', 'Generation YouTube', 'Airport Security: Colombia', 'Party Animals', "Egypt's Treasure Guardians", 'Tommy', '42 to 1', 'Evil Genius', 'Avengers: Secret Wars (Shorts)', 'Once', 'Howard', "Marvel's Ant-Man", 'Team Darryl', '700 Sharks', 'Star Wars Blips', 'Under the Sea: A Descendants Story', 'Marvel Rising: Secret Warriors', 'Auntie Edna', 'Marvel Rising: Initiation', 'Atlantis Rising', "Marvel's Rocket & Groot", 'Paris to Pittsburgh', 'Nature Boy', 'The Two Bills', "Sea of Hope: America's Underwater Treasures", 'MARS: Inside SpaceX', 'Drain Alcatraz', 'Year of the Scab', 'Planet of the Birds', 'Drain The Sunken Pirate City', 'Fearless Adventures with Jack Randall', 'Disney Illuminations Firework Show Disneyland Paris', 'Rocky Mountain Animal Rescue', 'Riina: le verit√† nascoste', "Secrets Of Christ's Tomb", 'Tangled: Short Cuts', 'Mexico Untamed', 'Awesome Animals', "Sam's Zookeeper Challenge", "Scuba Sam's World", 'Destination World', 'Positive Energy', 'Jaguar Beach Battle', 'Born in Africa', 'Heroes of the Long Road Home with Martha Raddatz', 'Botswana', 'Moana Sing-Along', 'Europe From Above', 'Eyewitness: D-Day', 'One Day at Disney', 'Z-O-M-B-I-E-S 2', 'Apollo: Missions to the Moon', 'Ultimate Survival WWII', 'Akashinga: The Brave Ones', 'Mack Wrestles', 'Shop Class', 'Rogue Trip', "Star Wars: Galaxy's Edge - Adventure Awaits", 'Marvel Battleworld: Mystery of the Thanostones', 'Apollo: Back to the Moon', 'Earth to Ned', 'Surviving the Mount St. Helens Disaster', 'Long Gone Summer', 'Spaced Out', 'Lance', 'Made in A Day', 'Disney Channel Halloween House Party', 'From Our Family to Yours', 'Feliz NaviDAD', 'Gathering Storm', 'Mars: One Day on the Red Planet', 'Expedition Amelia', 'Mickey Go Local', 'The Big Fib', 'Marvel Rising: Playing with Fire', 'Notre Dame: Race Against the Inferno', 'The Real Black Panther', 'Marvel Rising: Heart of Iron', 'The Little Mermaid Live!', 'Marvel Rising: Battle of the Bands', 'High School Musical: The Musical: The Holiday Special', 'Marvel Rising: Chasing Ghosts', 'Marvel Rising: Operation Shuri', "Marvel's Ultimate Comics", 'Forky Asks A Question: What Is Money?', 'A Celebration of the Music from Coco', 'Wild Nordic', 'Once Upon a Main Street', "ZOMBIES: Addison's Moonstone Mystery", "Deion's Double Play", 'The Undefeated Presents: Hamilton In-Depth', 'Shark vs. Whale', 'Women of Impact: Changing the World', 'Secrets of the Zoo: Down Under', 'Chasing the Equinox', 'The Dominican Dream', 'Wild Cats of India', 'The Disney Holiday Singalong', 'Prairie Dog Manor', 'The Wizard of Paws', 'Alaska Animal Rescue', 'Epic Holiday Showdown', 'Sharks of the Bermuda Triangle', 'The Giant Robber Crab', 'High School Musical: The Musical: The Series: The Special', 'Life Below Zero: Northern Territories', 'Shortsgiving with Big City Greens', 'Sharkcano', "World's Deadliest Snakes", 'Patagonia Wings', 'Most Wanted Sharks', 'Buried Secrets of Cordoba', "India's Wild Leopards", 'Secrets of the Bull Shark', 'Doc McStuffins: The Doc Is In', 'Sharks vs. Dolphins: Blood Battle', 'Port Security: Hamburg', 'Disney My Music Story: Perfume', 'Okavango: River of Dreams', 'Genoa Bridge Disaster', 'Puppy for Hanukkah', 'Shark vs. Surfer', 'Sauver Notre-Dame', 'Life and Death in Paradise: Crocs of the Caribbean', 'Heroes of the Sky: The Mighty Eighth Air Force', 'Heroes of The Mediterranean', "World's Biggest Great White Shark", 'Roll it Back', 'Buried Secrets of Keros', 'My Music Story: Yoshiki', 'My Music Story: Sukimaswitch', 'The Last Ice', 'Muppet Babies: Play Date', 'The Beatles: Get Back', 'Avatar: The Deep Dive - A Special Edition of 20/20', "Obi-Wan Kenobi: A Jedi's Return", 'If These Walls Could Sing', 'We Feed People', 'Star Wars Biomes', 'Encanto at the Hollywood Bowl', '20/20 Presents Black Panther: In Search of Wakanda', 'The Flagmakers', 'Running Wild with Bear Grylls: The Challenge', 'Welcome to the Club', 'Sneakerella', 'Small & Mighty', 'Mickey Saves Christmas', 'Cinderella: The Reunion, A Special Edition of 20/20', 'Harmonious Live!', 'More Than Robots', 'Hollywood Stargirl', 'Hamster & Gretel', 'Torn', 'Pentatonix: Around the World for the Holidays', 'Miraculous World: Shanghai ‚Äì The Legend of Ladydragon', 'Trevor: The Musical', 'Soul of a Nation Presents: X / o n e r a t e d ‚Äì The Murder of Malcolm X and 55 Years to Justice', 'King Shakir Recycle', 'Explorer: The Last Tepui', 'Delicacies Destiny', 'The Deepest Cave', 'Weekend Family Christmas Special', 'Step Into‚Ä¶ The Movies with Derek and Julianne Hough', 'Wolfgang', 'Twenty Something', 'Disney Princess Remixed: An Ultimate Princess Celebration', 'The Biggest Little Farm: The Return', 'Storm Rising', 'Nona', 'A Very Boy Band Holiday', 'Turning the Tables with Robin Roberts', 'The Hip Hop Nutcracker', 'BTS: Permission to Dance on Stage - LA', 'The Little Prince(ss)', 'Soundtrack #1', 'Jane Goodall: The Hope', 'Growing Fangs', 'A Spark Story', 'Soul of a Nation Presents: Screen Queens Rising', 'Al Davis vs. The NFL', 'Dinner Is Served', 'The Last of the Chupacabras', 'The Making of Loki', 'Man, Woman, Dog', 'PRIDE: To Be Seen - A Soul of a Nation Presentation', 'ZOMBI-Thon with Big City Greens', 'ASSEMBLED: The Making of What If...?', 'The Good, The Bad, The Hungry', 'Eureka!', 'Shortsmas with Big City Greens', 'The Queen Family Singalong', 'ASSEMBLED: The Making of Black Widow', 'Gorongosa: Paradise Reborn', 'Last of the Giants', 'Saving Giraffes: The Long Journey Home', 'The Simpsons x Bad Bunny: Te Deseo Lo Mejor', 'Unknown Waters with Jeremy Wade', 'Kingdom of the Polar Bears', 'King Tut In Colour', 'The Hatcher Family Dairy', 'Gordon Ramsay: Uncharted Showdown', 'Dickie V', 'The Way of the Cheetah', 'It Was Always Me: Behind the Story', 'Brain Games: On The Road', "Dancing With The Stars: The Pros' Most Memorable Moments", 'Extra Episode, or Not: Behind the Scenes of All the Same', 'Disney Gallery: Star Wars: The Book of Boba Fett', 'Meet Spidey and His Amazing Friends - shorts', 'Tangled Sing-Along', 'Mila in the Multiverse', 'The Low Tone Club', 'Schoolhouse Rock! 50th Anniversary Singalong', '@Gina Yei: #WithAllMyHeartAndMore', 'Voices Rising: The Music of Wakanda Forever', 'Disney100 | Special Look']

movie_names = ['Trick or Treat', 'The New Neighbor', 'You Lucky Dog', 'The Birth of Big Air', "World's Deadliest", 'Kings Ransom', 'Four Days in October', 'Guru of Go', 'Hounded', 'The Best That Never Was', 'Pony Excess', 'Small Potatoes: Who Killed the USFL?', 'Jordan Rides the Bus', "The Band That Wouldn't Die", 'Fernando Nation', 'Silly Little Game', 'Run Ricky Run', "There's No Place Like Home", 'Brian and the Boz', 'The Book of Manning', 'Bad Boys', 'The Day The Series Stopped', 'Youngstown Boys', 'Survive and Advance', 'The Radiator Springs 500½', 'Hawaiian: The Legend of Eddie Aikau', 'Slaying the Badger', 'Brothers in Exile', 'Elway To Marino', 'Fantastic Lies', 'Four Falls of Buffalo', 'Strangest Bird Alive', 'The Gospel According to Mac', 'Catholics vs. Convicts', 'I Hate Christian Laettner', 'Believeland', 'House of Darkness', 'This Magic Moment', 'Trojan War', 'Phi Slama Jama', 'Doc & Darryl', 'Bride & Prejudice', 'Party Animals', 'Tommy', '42 to 1', 'Evil Genius', 'Howard', 'Nature Boy', 'The Two Bills', 'Drain Alcatraz', 'Year of the Scab', 'Botswana', 'Akashinga: The Brave Ones', 'Mack Wrestles', 'Shop Class', 'Rogue Trip', 'Earth to Ned', 'Long Gone Summer', 'Spaced Out', 'Lance', 'Feliz NaviDAD', 'The Big Fib', "Deion's Double Play", 'The Dominican Dream', 'The Wizard of Paws', 'Most Wanted Sharks', 'The Last Ice', 'The Beatles: Get Back', '20/20 Presents Black Panther: In Search of Wakanda', 'Cinderella: The Reunion, A Special Edition of 20/20', 'Harmonious Live!', 'More Than Robots', 'Hollywood Stargirl', 'Pentatonix: Around the World for the Holidays', 'Miraculous World: Shanghai – The Legend of Ladydragon', 'Trevor: The Musical', 'Soul of a Nation Presents: X / o n e r a t e d – The Murder of Malcolm X and 55 Years to Justice', 'Step Into… The Movies with Derek and Julianne Hough', 'Wolfgang', 'Storm Rising', 'A Very Boy Band Holiday', 'The Hip Hop Nutcracker', 'Al Davis vs. The NFL', 'The Last of the Chupacabras', 'PRIDE: To Be Seen - A Soul of a Nation Presentation', 'The Good, The Bad, The Hungry', 'Eureka!', 'The Queen Family Singalong', 'Dickie V']


# CSV file setup
with open('movie_data1.csv', 'w', newline='', encoding='utf-8') as file:
    writer = csv.writer(file)
    writer.writerow(["Movie Name", "Rating Image Link"])  # Writing headers

    for movie in movie_names:
        movie_name, rating_img_link = fetch_movie_data(movie)
        print(movie_name)
        print(rating_img_link)
        print()
        if movie_name and rating_img_link:
            writer.writerow([movie_name, rating_img_link])
